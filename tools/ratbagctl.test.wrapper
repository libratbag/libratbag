#!/bin/sh
#
# Wrapper to execute ratbagctl.test. Required because meson does not allow
# a configure_file() output to be used as test. And besides, we need to run
# this as root anyway.
#
if [ `whoami` != "root" ]; then
	echo "This test must be run as root"
	# Skippedy skip skip
	exit 77
fi

if ! [ -z "$CIRCLECI" ]; then
	echo "CircleCI does not have DBus. Skipping test"
	# Skippedy skip skip
	exit 77
fi

MESON_BUILD_ROOT="$1"

"$MESON_BUILD_ROOT"/ratbagctl.test
